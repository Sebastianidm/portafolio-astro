---
const { 
    titulo, 
    descripcion, 
    tecnologias, 
    githubUrl, 
    stratagem 
} = Astro.props;---

<div class="bg-gray-900/50 border border-fuchsia-500 rounded-lg p-6 mb-8 animate-pulse-fuchsia transition-transform duration-300 hover:scale-[1.02]">
    
    <h3 class="text-2xl font-bold text-fuchsia-400 mb-2">{titulo}</h3>
    
    <p class="text-slate-300 mb-3">{descripcion}</p>
    
    <p class="text-sm text-slate-400 mb-4">
        <strong>Tecnologías:</strong> {tecnologias}
    </p>
    
    <button
        type="button"
        class="open-modal-btn inline-block px-5 py-2 bg-lime-400 text-black rounded font-bold transition-all duration-200 hover:bg-lime-300 hover:scale-105"
        data-url={githubUrl}
        data-title={titulo}
        data-sequence={JSON.stringify(stratagem)} >
        Acceder al Repositorio
    </button>
</div>

<script>
    // Astro es inteligente. Este script se ejecutará una vez 
    // y se aplicará a todos los 'ProyectoItem'.
    const allModalButtons = document.querySelectorAll('.open-modal-btn');

    allModalButtons.forEach(button => {
        // Esta comprobación evita que se añadan múltiples 'listeners'
        // si la página se recarga en modo de desarrollo (HMR).
        if ((button as any)._hasModalListener) return;
        (button as any)._hasModalListener = true;

        // Añadimos el 'listener' de clic
        button.addEventListener('click', (e) => {
            const btn = e.currentTarget as HTMLButtonElement;
            
            // Leemos los datos que pusimos en el HTML
            const url = btn.dataset.url;
            const title = btn.dataset.title;
            const sequenceStr = btn.dataset.sequence;

            if (!url || !title || !sequenceStr) {
                return console.error('Faltan datos en el botón del modal');
            }

            // Convertimos el string JSON de vuelta a un array de JavaScript
            const sequence = JSON.parse(sequenceStr);

            // Llamamos la función GLOBAL que definimos en StratagemModal.astro
            // y le pasamos los datos de ESTE proyecto.
            if (typeof (window as any).showStratagemModal === 'function') {
                (window as any).showStratagemModal({
                    url: url,
                    title: title,
                    sequence: sequence
                });
            }
        });
    });
</script>